{% extends 'base.html' %}
{% block title %}Vehicle Inventory{% endblock %}

{% block content %}
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold">Vehicle Inventory</h1>
    <a href="{{ url_for('vehicles.create', next=request.full_path) }}"
       class="hidden md:inline-flex items-center h-10 px-3 rounded-md bg-brand hover:bg-brand-dark text-white text-sm">
       + Add Vehicle
    </a>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for vehicle in vehicles %}
      <div class="bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col">
        {% if vehicle.photo_url %}
          <img src="{{ vehicle.photo_url }}" alt="{{ vehicle.make }} {{ vehicle.model }}"
               class="h-48 w-full object-cover" loading="lazy" decoding="async"
               onerror="this.style.display='none'">
        {% endif %}
        <div class="p-4 flex flex-col gap-2">
          <div>
            <h3 class="font-semibold">{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</h3>
            <p class="text-xs text-gray-500">{{ vehicle.vin }}</p>
          </div>
          <p class="text-sm"><span class="font-semibold">Color:</span> {{ vehicle.color or 'N/A' }}</p>
          <p class="text-sm"><span class="font-semibold">Price:</span> {{ "{:,.2f}".format(vehicle.price) }} DH</p>

          <div class="mt-3 flex gap-2">
            <a href="{{ url_for('vehicles.details', vehicle_id=vehicle.id, next=request.full_path) }}"
               class="px-2.5 py-1 text-sm rounded-md border border-brand text-brand hover:bg-brand hover:text-white">Details</a>

            <a href="{{ url_for('vehicles.edit', vehicle_id=vehicle.id, next=request.full_path) }}"
               class="px-2.5 py-1 text-sm rounded-md border text-gray-700 hover:bg-gray-100">Edit</a>

            <form action="{{ url_for('vehicles.delete', vehicle_id=vehicle.id) }}" method="post"
                  onsubmit="return confirm('Delete this vehicle?');">
              <input type="hidden" name="next" value="{{ request.full_path }}">
              <button type="submit"
                      class="px-2.5 py-1 text-sm rounded-md border border-red-300 text-red-600 hover:bg-red-50">
                Delete
              </button>
            </form>
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-span-full text-center text-gray-500 py-12">
        No vehicles found. <a href="{{ url_for('vehicles.create', next=request.full_path) }}" class="text-brand hover:underline">Add the first one</a>.
      </div>
    {% endfor %}
  </div>

  {% if total_pages and total_pages > 1 and not search_query %}
    <nav class="mt-6 flex justify-center">
      <ul class="flex gap-1">
        {% for p in range(1, total_pages + 1) %}
          <li>
            <a href="{{ url_for('vehicles.index', page=p) }}"
               class="px-3 py-1.5 rounded-md border text-sm
                      {% if p == page %}bg-brand text-white border-brand{% else %}bg-white hover:bg-gray-50{% endif %}">
              {{ p }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
